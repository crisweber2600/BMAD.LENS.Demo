---
repo: bmad-chat
remote: https://github.com/crisweber2600/bmad-chat.git
default_branch: main
source_commit: 726592167a1247c1a75baa0a214a0bca5468aa8f
generated_at: "2026-02-07T00:00:00Z"
layer: repo
domain: BMAD
service: CHAT
generator: scout-auto-pipeline
---

# bmad-chat â€” Canonical Documentation

## 1. Overview

bmad-chat is a **React/TypeScript single-page application** providing a collaboration UI for BMAD workflow interactions. It was generated by **GitHub Spark** and currently operates as a fully client-side application with no backend integration. All data persistence uses the Spark platform's local key-value store (`window.spark.kv`), and AI capabilities use the Spark in-browser LLM (`window.spark.llm`).

**Key facts:**
- React 19 + TypeScript 5.7 + Vite 7.2 + Tailwind 4.1
- 16 commits, 119 files, ~10,615 lines of TypeScript
- 20+ UI components, 7 custom hooks, 12+ type interfaces
- Zero test files â€” no quality assurance pipeline
- **Critical gap:** No integration with bmadServer despite sharing the CHAT service domain

**Role in domain:** bmad-chat is the **user-facing frontend** for BMAD collaboration workflows. Its planned role is to provide a rich UI for multi-participant BMAD sessions backed by bmadServer, but currently it operates in complete isolation using GitHub Spark platform APIs.

## 2. Technology Stack

| Layer | Technology | Version |
|-------|-----------|---------|
| **UI Framework** | React | 19 |
| **Language** | TypeScript | 5.7 |
| **Build Tool** | Vite | 7.2 |
| **Styling** | Tailwind CSS | 4.1 |
| **Component Library** | Radix UI (shadcn/ui) | Latest |
| **Toast Notifications** | Sonner | Latest |
| **Data Storage** | `window.spark.kv` (GitHub Spark) | Platform |
| **AI Integration** | `window.spark.llm` (GitHub Spark) | Platform |
| **Icons** | Lucide React | Latest |
| **Platform** | GitHub Spark | â€” |

### Key Dependencies Note

bmad-chat is **platform-locked to GitHub Spark**. The `window.spark.kv` and `window.spark.llm` APIs are Spark-specific and have no server-side equivalents. Migration to bmadServer integration requires replacing these with REST API calls and WebSocket connections.

## 3. Architecture

### Code Organization

```
src/
â”œâ”€â”€ App.tsx                    # Main app component (662 lines)
â”œâ”€â”€ components/                # 20+ UI components
â”‚   â”œâ”€â”€ AuthForm.tsx           # Login/signup forms
â”‚   â”œâ”€â”€ ChatInput.tsx          # Message composition
â”‚   â”œâ”€â”€ ChatList.tsx           # Chat sidebar
â”‚   â”œâ”€â”€ ChatMessage.tsx        # Message rendering
â”‚   â”œâ”€â”€ MomentumDashboard.tsx  # Activity dashboard
â”‚   â”œâ”€â”€ NewChatDialog.tsx      # Create chat dialog
â”‚   â”œâ”€â”€ PRCard.tsx             # Pull request card
â”‚   â”œâ”€â”€ PRDialog.tsx           # PR detail view
â”‚   â”œâ”€â”€ CreatePRDialog.tsx     # Create PR form
â”‚   â”œâ”€â”€ FileDiffViewer.tsx     # Code diff display
â”‚   â”œâ”€â”€ ActiveUsers.tsx        # Presence indicators
â”‚   â”œâ”€â”€ TypingIndicator.tsx    # Real-time typing
â”‚   â”œâ”€â”€ ActivityFeed.tsx       # Activity stream
â”‚   â”œâ”€â”€ TranslateButton.tsx    # Translation trigger
â”‚   â”œâ”€â”€ TranslatedText.tsx     # Translated content display
â”‚   â”œâ”€â”€ DocumentTranslationView.tsx
â”‚   â”œâ”€â”€ EmojiReactionPicker.tsx
â”‚   â”œâ”€â”€ EmojiReactionsDisplay.tsx
â”‚   â”œâ”€â”€ InlineCommentThread.tsx
â”‚   â”œâ”€â”€ FilePreviewDialog.tsx
â”‚   â”œâ”€â”€ AllFilesPreviewDialog.tsx
â”‚   â””â”€â”€ ErrorFallback.tsx      # Error boundary
â”œâ”€â”€ hooks/                     # 7+ custom React hooks
â”‚   â”œâ”€â”€ use-auth.ts            # Authentication state
â”‚   â”œâ”€â”€ use-chats.ts           # Chat CRUD operations
â”‚   â”œâ”€â”€ use-chat-actions.ts    # Chat interaction handlers
â”‚   â”œâ”€â”€ use-collaboration.ts   # Presence & collaboration
â”‚   â”œâ”€â”€ use-pending-changes.ts # Change tracking
â”‚   â”œâ”€â”€ use-pull-requests.ts   # PR management
â”‚   â”œâ”€â”€ use-ui-state.ts        # UI state management
â”‚   â””â”€â”€ use-mobile.ts          # Mobile responsiveness
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ auth.ts                # Auth service (Spark KV)
â”‚   â”œâ”€â”€ types.ts               # TypeScript type definitions
â”‚   â”œâ”€â”€ utils.ts               # Utility functions
â”‚   â””â”€â”€ services/
â”‚       â”œâ”€â”€ chat.service.ts    # Chat CRUD (Spark KV)
â”‚       â”œâ”€â”€ ai.service.ts      # AI generation (Spark LLM)
â”‚       â”œâ”€â”€ pr.service.ts      # PR management (Spark KV)
â”‚       â”œâ”€â”€ line-comment.service.ts  # Code review comments
â”‚       â””â”€â”€ collaboration.ts   # Presence tracking (Spark KV)
â””â”€â”€ components/ui/             # shadcn/ui primitives (Radix-based)
```

### Key Patterns

| Pattern | Implementation | Notes |
|---------|---------------|-------|
| **Spark KV Storage** | `window.spark.kv.set/get/delete` for all persistence | Platform-locked â€” no server sync |
| **Spark LLM** | `window.spark.llm(prompt, 'gpt-4o', true)` for AI | Browser-only AI â€” GPT-4o via Spark |
| **React Hooks** | Custom hooks for all domain logic | Clean separation of concerns |
| **shadcn/ui Components** | Radix UI primitives with Tailwind styling | Accessible, composable |
| **Role-Based Translation** | Technical â†” business term translation via AI | Innovative UX pattern |
| **Optimistic Updates** | UI updates before persistence confirms | Good UX, risky without server validation |

### Entry Points

- `src/App.tsx` â€” Root component (662 lines), handles routing and layout
- `src/lib/auth.ts` â€” Authentication entry point
- `src/lib/services/chat.service.ts` â€” Primary data service

## 4. API Surface

bmad-chat has **no REST API** â€” it is a client-side SPA. Its "API" is the service layer that wraps `window.spark.kv` and `window.spark.llm`.

### Service Layer

| Service | Functions | Storage Backend | Purpose |
|---------|-----------|----------------|---------|
| **chat.service.ts** | `getChats`, `getChat`, `createChat`, `sendMessage`, `updateChat`, `deleteChat` | `window.spark.kv` | Chat CRUD with local persistence |
| **ai.service.ts** | `generateResponse`, `translateMessage`, `generateCodeReview` | `window.spark.llm` | In-browser AI for responses, translations, code review |
| **pr.service.ts** | `getPullRequests`, `createPR`, `updatePRStatus`, `addComment` | `window.spark.kv` | Pull request management |
| **line-comment.service.ts** | `addLineComment`, `resolveComment`, `addReply`, `toggleReaction` | `window.spark.kv` | Code review line comments |
| **auth.ts** | `signUp`, `signIn`, `signOut`, `getCurrentUser`, `setCurrentUser` | `window.spark.kv` | Local auth (**plaintext passwords!**) |
| **collaboration.ts** | `CollaborationManager` class | `window.spark.kv` | Presence tracking, typing indicators, collaboration events |

### Hook Layer

| Hook | Wraps | Purpose |
|------|-------|---------|
| `use-auth` | `auth.ts` | Login/signup/logout state management |
| `use-chats` | `chat.service.ts` | Chat list and active chat state |
| `use-chat-actions` | `chat.service.ts` + `ai.service.ts` | Send message, AI response, translation |
| `use-collaboration` | `collaboration.ts` | Active users, typing indicators |
| `use-pending-changes` | Local state | Track unsaved file changes |
| `use-pull-requests` | `pr.service.ts` | PR list and actions |
| `use-ui-state` | Local state | Sidebar, dialogs, view state |
| `use-mobile` | Media query | Responsive breakpoint detection |

## 5. Data Models

### Core Types (from `src/lib/types.ts`)

| Type | Key Fields | Notes |
|------|-----------|-------|
| **User** | `id`, `name`, `avatarUrl`, `role` ('technical' \| 'business'), `email` | Basic user identity |
| **AuthUser** | extends User + `password`, `createdAt` | âš ï¸ Password stored in plaintext |
| **UserPresence** | `userId`, `userName`, `activeChat`, `lastSeen`, `isTyping`, `cursorPosition` | Collaboration presence |
| **Chat** | `id`, `title`, `messages[]`, `participants[]`, `domain?`, `service?`, `feature?` | Core conversation entity |
| **Message** | `id`, `chatId`, `content`, `role` ('user' \| 'assistant'), `timestamp`, `fileChanges?`, `translations?` | Chat message with optional attachments |
| **MessageTranslation** | `role` (UserRole), `segments` (TranslatedSegment[]) | Role-based translation |
| **TranslatedSegment** | `original`, `translated`, `type` ('technical' \| 'business' \| 'plain') | Translation unit |
| **FileChange** | `path`, `additions[]`, `deletions[]`, `status`, `lineComments?` | Code change tracking |
| **PullRequest** | `id`, `title`, `description`, `chatId`, `author`, `status`, `fileChanges[]`, `comments[]`, `approvals[]` | PR entity |
| **PRComment** | `id`, `author`, `content`, `timestamp`, `type` ('comment' \| 'approval' \| 'request-changes') | PR review comment |
| **LineComment** | `id`, `fileChange`, `lineNumber`, `author`, `content`, `timestamp`, `resolved`, `replies[]` | Inline code comment |
| **EmojiReaction** | `emoji`, `userId`, `userName`, `timestamp` | Message reaction |
| **CollaborationEvent** | `id`, `type`, `userId`, `chatId?`, `prId?`, `timestamp`, `metadata?` | Collaboration audit event |

### Storage Keys (Spark KV)

| Key Pattern | Value Type | Purpose |
|-------------|-----------|---------|
| `users` | `AuthUser[]` | User registry |
| `currentUser` | `string` (user ID) | Active session |
| `chats` | `Chat[]` | All chat conversations |
| `pullRequests` | `PullRequest[]` | All pull requests |
| `presence:{chatId}` | `UserPresence[]` | Active users per chat |
| `collaboration:{chatId}` | `CollaborationEvent[]` | Collaboration events |

## 6. Integration Points

### Current Integrations

| Integration | Mechanism | Status |
|------------|-----------|--------|
| **GitHub Spark KV** | `window.spark.kv` | âœ… Active â€” all data persistence |
| **GitHub Spark LLM** | `window.spark.llm` (GPT-4o) | âœ… Active â€” AI responses, translation |
| **bmadServer** | None | ğŸ”´ **Not connected** |

### Planned Integrations (Gap Analysis)

| Target | Mechanism Needed | Current Blocker |
|--------|-----------------|-----------------|
| **bmadServer Auth** | REST: `POST /api/v1/auth/login` â†’ JWT | Uses Spark KV with plaintext passwords |
| **bmadServer Chat** | REST: `GET/POST /api/chat/` + SignalR `/hubs/chat` | Uses Spark KV for local storage |
| **bmadServer Workflows** | REST: `GET/POST /api/v1/workflows/` | No workflow backend connection |
| **bmadServer Decisions** | REST: `GET/POST /api/v1/decisions/` | No decision backend connection |
| **bmadServer Translation** | REST: `GET/PUT /api/v1/translations/` | Uses Spark LLM locally |

### Data Model Overlap with bmadServer

Both repos have structurally similar models that could be unified:
- **User** â€” both have user identity with roles
- **Chat/Message** â€” both have conversation models
- **Workflow** â€” bmadServer has full orchestration; bmad-chat has UI-level workflow awareness
- **Translation** â€” both have technicalâ†”business translation concepts
- **PR/FileChange** â€” bmad-chat has richer code review UI; bmadServer has persistence

## 7. Build & Deploy

### Build

```bash
# Install dependencies
npm install

# Development server
npm run dev

# Production build
npm run build
```

### Deploy

Currently deployed via GitHub Spark platform â€” no custom deployment pipeline.

### Prerequisites

- Node.js (LTS)
- GitHub Spark CLI or platform access

## 8. Configuration

### Files

| File | Purpose |
|------|---------|
| `package.json` | Dependencies, scripts |
| `tsconfig.json` | TypeScript configuration |
| `vite.config.ts` | Vite bundler configuration |
| `tailwind.config.ts` | Tailwind CSS configuration |
| `components.json` | shadcn/ui component registry |

### Environment Variables

None documented â€” the app relies on GitHub Spark platform APIs which are available in the Spark runtime environment.

### Secrets

None â€” authentication is local (Spark KV), no server-side secrets needed (which is itself a security issue).

## 9. Testing

### Test Strategy

ğŸ”´ **No tests exist.** Zero test files found in the repository.

### Test Coverage

| Area | Coverage | Notes |
|------|----------|-------|
| Unit tests | ğŸ”´ None | No Vitest/Jest setup |
| Component tests | ğŸ”´ None | No React Testing Library |
| Integration tests | ğŸ”´ None | No API integration tests |
| E2E tests | ğŸ”´ None | No Playwright setup |
| Linting | âš ï¸ Unknown | ESLint may be configured but not verified |

### Recommended Test Stack

| Tool | Purpose |
|------|---------|
| **Vitest** | Unit tests for services and hooks |
| **React Testing Library** | Component rendering tests |
| **Playwright** | E2E UI workflows |
| **ESLint** | Static analysis |
| **TypeScript strict mode** | Type-level correctness |

## 10. Known Issues & Technical Debt

| # | Issue | Severity | Impact | Recommendation |
|---|-------|----------|--------|----------------|
| 1 | **Plaintext passwords** | ğŸ”´ CRITICAL | Passwords stored raw in `window.spark.kv` â€” no hashing, no server validation | Move auth to bmadServer JWT; eliminate client-side password storage |
| 2 | **No bmadServer integration** | ğŸ”´ CRITICAL | All data local-only â€” no cross-device sync, no collaboration persistence | Replace Spark KV with REST API calls to bmadServer |
| 3 | **Zero test coverage** | ğŸ”´ CRITICAL | 10K+ LOC with no quality gate â€” regressions invisible | Add Vitest + Playwright + CI pipeline |
| 4 | **Platform lock-in (Spark)** | âš ï¸ HIGH | `window.spark.kv/llm` APIs have no standard equivalent | Abstract behind service interfaces; swap implementations |
| 5 | **App.tsx is 662 lines** | âš ï¸ MEDIUM | Monolithic root component â€” hard to maintain | Extract into router + layout + page components |
| 6 | **No CI/CD pipeline** | âš ï¸ MEDIUM | No automated build/lint/test | Add GitHub Actions: build + lint + test |
| 7 | **No error boundary strategy** | LOW | `ErrorFallback` component exists but not consistently applied | Wrap all route-level components in error boundaries |

### ğŸ”´ Critical Security Finding

Authentication is client-side only. The `auth.ts` `signUp` function stores raw passwords in `window.spark.kv`:

```typescript
const newUser: AuthUser = {
  id: `user-${Date.now()}`,
  email, password, name, role,  // password stored in plaintext
  avatarUrl: `https://api.dicebear.com/...`,
  createdAt: Date.now(),
}
await window.spark.kv.set(USERS_KEY, users)
```

This MUST be replaced with server-side authentication via bmadServer's JWT system.

## 11. BMAD Readiness

### Assessment: ğŸ”´ NOT READY

bmad-chat cannot enter BMAD lifecycle planning until critical architectural gaps are resolved.

### Readiness Checklist

| Criterion | Status | Blocker |
|-----------|--------|---------|
| **Backend integration** | ğŸ”´ | No connection to bmadServer â€” all data local |
| **Authentication** | ğŸ”´ | Plaintext password storage â€” security critical |
| **Test coverage** | ğŸ”´ | Zero tests â€” cannot validate changes safely |
| **CI/CD pipeline** | ğŸ”´ | No automated build/test pipeline |
| **Architecture stability** | âš ï¸ | Spark platform dependency unclear for production |
| **Data model alignment** | âš ï¸ | Types exist but not synced with bmadServer entities |
| **Error handling** | âš ï¸ | Basic error boundaries but not comprehensive |

### Prerequisites for BMAD /pre-plan

1. âœ… Repository exists with meaningful code
2. ğŸ”´ Decide: Spark platform vs. bmadServer integration (architectural decision)
3. ğŸ”´ Resolve plaintext password security issue
4. ğŸ”´ Add minimum test coverage (services + critical UI flows)
5. ğŸ”´ Add CI pipeline (build + lint + type-check)
6. âš ï¸ Align data models with bmadServer (shared types or contract)

### Recommended Sequencing

bmad-chat should be planned **after** bmadServer is stable, since the integration architecture depends on bmadServer's API surface being finalized. The recommended approach:

1. **First:** Complete bmadServer API stabilization
2. **Then:** Plan bmad-chat integration (replace Spark APIs with bmadServer REST + SignalR)
3. **Finally:** Add tests and CI for the integrated application
